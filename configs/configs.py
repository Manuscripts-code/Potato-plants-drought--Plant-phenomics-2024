from pathlib import Path

import mlflow
import numpy as np
from torchvision import transforms

import data_loader.transformations as transforms_hyp

### Registry and log ###
BASE_DIR = Path(__file__).parent.parent.absolute()
MODEL_REGISTRY = Path(BASE_DIR, "experiments")
LOGS_DIR = Path(BASE_DIR, "logs")

MODEL_REGISTRY.mkdir(parents=True, exist_ok=True)
LOGS_DIR.mkdir(parents=True, exist_ok=True)

TRACKING_URI = "file:///" + str(MODEL_REGISTRY.absolute())
mlflow.set_tracking_uri(TRACKING_URI)


### Data loading ###
DATA_DIR = [
	"E:\\janez\\data\\sliced_converted_images\\slikanje_2022_rad_1",
	"E:\\janez\\data\\sliced_converted_images\\slikanje_2022_rad_2",
	"E:\\janez\\data\\sliced_converted_images\\slikanje_2022_rad_3",
	"E:\\janez\\data\\sliced_converted_images\\slikanje_2022_rad_4",
	"E:\\janez\\data\\sliced_converted_images\\slikanje_2022_rad_5"
]
CASHED_IMAGES_DIR = BASE_DIR / "data"
USE_CASHED_IMAGES = True
SAVE_CASHED_IMAGES = True
NOISY_BANDS = np.concatenate(
	[np.arange(26), np.arange(140, 171), np.arange(430, 448)]
)  # hardcoded bands to remove
IMG_SIZE = 50
GROUPS = {
	# groupes by labels
	"KK-K": "KIS_krka_control",
	"KK-S": "KIS_krka_drought",
	"KS-K": "KIS_savinja_control",
	"KS-S": "KIS_savinja_drought",
}
TRANSFORM_TRAIN = transforms.Compose(
	[
		transforms_hyp.RandomMirror(),
		transforms_hyp.RandomCrop(IMG_SIZE),
		transforms.ToTensor(),
	]
)
TRANSFORM_TEST = transforms.Compose(
	[
		transforms_hyp.Rescale(IMG_SIZE),
		transforms.ToTensor(),
	]
)
TRANSFORM_DURING_LOADING = transforms.Compose([transforms_hyp.NoTransformation()])


### Visualization ###
_BANDS = [
    409.759827,
    413.398185,
    417.036543,
    420.674901,
    424.313259,
    427.951617,
    431.589975,
    435.228332,
    438.866690,
    442.505048,
    446.143406,
    449.781764,
    453.420122,
    457.058480,
    460.696838,
    464.335196,
    467.973553,
    471.611911,
    475.250269,
    478.888627,
    482.526985,
    486.165343,
    489.803701,
    493.442059,
    497.080416,
    500.718774,
    504.357132,
    507.995490,
    511.633848,
    515.272206,
    518.910564,
    522.548922,
    526.187279,
    529.825637,
    533.463995,
    537.102353,
    540.740711,
    544.379069,
    548.017427,
    551.655785,
    555.294143,
    558.932500,
    562.570858,
    566.209216,
    569.847574,
    573.485932,
    577.124290,
    580.762648,
    584.401006,
    588.039363,
    591.677721,
    595.316079,
    598.954437,
    602.592795,
    606.231153,
    609.869511,
    613.507869,
    617.146227,
    620.784584,
    624.422942,
    628.061300,
    631.699658,
    635.338016,
    638.976374,
    642.614732,
    646.253090,
    649.891447,
    653.529805,
    657.168163,
    660.806521,
    664.444879,
    668.083237,
    671.721595,
    675.359953,
    678.998311,
    682.636668,
    686.275026,
    689.913384,
    693.551742,
    697.190100,
    700.828458,
    704.466816,
    708.105174,
    711.743531,
    715.381889,
    719.020247,
    722.658605,
    726.296963,
    729.935321,
    733.573679,
    737.212037,
    740.850395,
    744.488752,
    748.127110,
    751.765468,
    755.403826,
    759.042184,
    762.680542,
    766.318900,
    769.957258,
    773.595615,
    777.233973,
    780.872331,
    784.510689,
    788.149047,
    791.787405,
    795.425763,
    799.064121,
    802.702479,
    806.340836,
    809.979194,
    813.617552,
    817.255910,
    820.894268,
    824.532626,
    828.170984,
    831.809342,
    835.447699,
    839.086057,
    842.724415,
    846.362773,
    850.001131,
    853.639489,
    857.277847,
    860.916205,
    864.554562,
    868.192920,
    871.831278,
    875.469636,
    879.107994,
    882.746352,
    886.384710,
    890.023068,
    893.661426,
    897.299783,
    900.938141,
    904.576499,
    908.214857,
    911.853215,
    915.491573,
    919.129931,
    922.768289,
    926.406646,
    930.045004,
    933.683362,
    937.321720,
    940.960078,
    944.598436,
    948.236794,
    951.875152,
    955.513510,
    959.151867,
    962.790225,
    966.428583,
    970.066941,
    973.705299,
    977.343657,
    980.982015,
    984.620373,
    988.258730,
    950.108239,
    955.541844,
    960.975448,
    966.409053,
    971.842657,
    977.276262,
    982.709866,
    988.143471,
    993.577075,
    999.010679,
    1004.444284,
    1009.877888,
    1015.311493,
    1020.745097,
    1026.178702,
    1031.612306,
    1037.045911,
    1042.479515,
    1047.913120,
    1053.346724,
    1058.780329,
    1064.213933,
    1069.647538,
    1075.081142,
    1080.514747,
    1085.948351,
    1091.381956,
    1096.815560,
    1102.249165,
    1107.682769,
    1113.116374,
    1118.549978,
    1123.983583,
    1129.417187,
    1134.850792,
    1140.284396,
    1145.718001,
    1151.151605,
    1156.585210,
    1162.018814,
    1167.452419,
    1172.886023,
    1178.319627,
    1183.753232,
    1189.186836,
    1194.620441,
    1200.054045,
    1205.487650,
    1210.921254,
    1216.354859,
    1221.788463,
    1227.222068,
    1232.655672,
    1238.089277,
    1243.522881,
    1248.956486,
    1254.390090,
    1259.823695,
    1265.257299,
    1270.690904,
    1276.124508,
    1281.558113,
    1286.991717,
    1292.425322,
    1297.858926,
    1303.292531,
    1308.726135,
    1314.159740,
    1319.593344,
    1325.026949,
    1330.460553,
    1335.894158,
    1341.327762,
    1346.761367,
    1352.194971,
    1357.628575,
    1363.062180,
    1368.495784,
    1373.929389,
    1379.362993,
    1384.796598,
    1390.230202,
    1395.663807,
    1401.097411,
    1406.531016,
    1411.964620,
    1417.398225,
    1422.831829,
    1428.265434,
    1433.699038,
    1439.132643,
    1444.566247,
    1449.999852,
    1455.433456,
    1460.867061,
    1466.300665,
    1471.734270,
    1477.167874,
    1482.601479,
    1488.035083,
    1493.468688,
    1498.902292,
    1504.335897,
    1509.769501,
    1515.203106,
    1520.636710,
    1526.070315,
    1531.503919,
    1536.937523,
    1542.371128,
    1547.804732,
    1553.238337,
    1558.671941,
    1564.105546,
    1569.539150,
    1574.972755,
    1580.406359,
    1585.839964,
    1591.273568,
    1596.707173,
    1602.140777,
    1607.574382,
    1613.007986,
    1618.441591,
    1623.875195,
    1629.308800,
    1634.742404,
    1640.176009,
    1645.609613,
    1651.043218,
    1656.476822,
    1661.910427,
    1667.344031,
    1672.777636,
    1678.211240,
    1683.644845,
    1689.078449,
    1694.512054,
    1699.945658,
    1705.379263,
    1710.812867,
    1716.246471,
    1721.680076,
    1727.113680,
    1732.547285,
    1737.980889,
    1743.414494,
    1748.848098,
    1754.281703,
    1759.715307,
    1765.148912,
    1770.582516,
    1776.016121,
    1781.449725,
    1786.883330,
    1792.316934,
    1797.750539,
    1803.184143,
    1808.617748,
    1814.051352,
    1819.484957,
    1824.918561,
    1830.352166,
    1835.785770,
    1841.219375,
    1846.652979,
    1852.086584,
    1857.520188,
    1862.953793,
    1868.387397,
    1873.821002,
    1879.254606,
    1884.688211,
    1890.121815,
    1895.555419,
    1900.989024,
    1906.422628,
    1911.856233,
    1917.289837,
    1922.723442,
    1928.157046,
    1933.590651,
    1939.024255,
    1944.457860,
    1949.891464,
    1955.325069,
    1960.758673,
    1966.192278,
    1971.625882,
    1977.059487,
    1982.493091,
    1987.926696,
    1993.360300,
    1998.793905,
    2004.227509,
    2009.661114,
    2015.094718,
    2020.528323,
    2025.961927,
    2031.395532,
    2036.829136,
    2042.262741,
    2047.696345,
    2053.129950,
    2058.563554,
    2063.997159,
    2069.430763,
    2074.864368,
    2080.297972,
    2085.731576,
    2091.165181,
    2096.598785,
    2102.032390,
    2107.465994,
    2112.899599,
    2118.333203,
    2123.766808,
    2129.200412,
    2134.634017,
    2140.067621,
    2145.501226,
    2150.934830,
    2156.368435,
    2161.802039,
    2167.235644,
    2172.669248,
    2178.102853,
    2183.536457,
    2188.970062,
    2194.403666,
    2199.837271,
    2205.270875,
    2210.704480,
    2216.138084,
    2221.571689,
    2227.005293,
    2232.438898,
    2237.872502,
    2243.306107,
    2248.739711,
    2254.173316,
    2259.606920,
    2265.040524,
    2270.474129,
    2275.907733,
    2281.341338,
    2286.774942,
    2292.208547,
    2297.642151,
    2303.075756,
    2308.509360,
    2313.942965,
    2319.376569,
    2324.810174,
    2330.243778,
    2335.677383,
    2341.110987,
    2346.544592,
    2351.978196,
    2357.411801,
    2362.845405,
    2368.279010,
    2373.712614,
    2379.146219,
    2384.579823,
    2390.013428,
    2395.447032,
    2400.880637,
    2406.314241,
    2411.747846,
    2417.181450,
    2422.615055,
    2428.048659,
    2433.482264,
    2438.915868,
    2444.349472,
    2449.783077,
    2455.216681,
    2460.650286,
    2466.083890,
    2471.517495,
    2476.951099,
    2482.384704,
    2487.818308,
    2493.251913,
    2498.685517,
    2504.119122,
    2509.552726,
]
BANDS = np.delete(_BANDS, NOISY_BANDS)
